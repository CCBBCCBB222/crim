
local FOVModule = {}

function FOVModule:Init(Library, Window)
    local CameraSection = Window:Page({Name = "Camera", Columns = 2}):Section({Name = "Camera Settings", Side = 1})
    
    local uiTransparencyData = {}
    local cam = workspace.CurrentCamera
    local originalFOV = cam.FieldOfView
    local fovSettings = {
        enabled = false,
        value = originalFOV
    }
    
    local function hideUIInLevelFrame(elementNames)
        local player = game.Players.LocalPlayer
        local playerGui = player:WaitForChild("PlayerGui")
        uiTransparencyData = {}
        
        local function processElement(element)
            local data = {}
            if element:IsA("GuiObject") then
                if element:IsA("TextLabel") or element:IsA("TextButton") or element:IsA("TextBox") then
                    data.TextTransparency = element.TextTransparency
                    element.TextTransparency = 1
                end
                if element:IsA("Frame") or element:IsA("TextButton") or element:IsA("ImageButton") then
                    data.BackgroundTransparency = element.BackgroundTransparency
                    element.BackgroundTransparency = 1
                end
                if element:IsA("ImageLabel") or element:IsA("ImageButton") then
                    data.ImageTransparency = element.ImageTransparency
                    element.ImageTransparency = 1
                end
            end
            if next(data) ~= nil then
                uiTransparencyData[element] = data
            end
        end
        
        local function findLevelFrame(parent)
            for _, child in ipairs(parent:GetChildren()) do
                if child.Name == "LevelFrame" then
                    return child
                end
                local found = findLevelFrame(child)
                if found then
                    return found
                end
            end
            return nil
        end
        
        local levelFrame = findLevelFrame(playerGui)
        if not levelFrame then
            return false
        end
        
        for _, elementName in ipairs(elementNames or {"Stat", "LevelNumber", "Levelbox", "bar", "bar2", "Max", "BG"}) do
            local element = levelFrame:FindFirstChild(elementName, true)
            if element then
                processElement(element)
            end
        end
        return true
    end
    
    local function showUIInLevelFrame()
        for guiObject, transparencyData in pairs(uiTransparencyData) do
            if guiObject and guiObject.Parent then
                for property, value in pairs(transparencyData) do
                    if guiObject[property] ~= nil then
                        guiObject[property] = value
                    end
                end
            end
        end
        uiTransparencyData = {}
    end
    
    game:GetService("RunService").RenderStepped:Connect(function()
        if fovSettings.enabled and cam then
            cam.FieldOfView = fovSettings.value
        else
            cam.FieldOfView = originalFOV
        end
    end)
    
    CameraSection:Toggle({
        Name = "FOV Changer", 
        Default = false, 
        Callback = function(e)
            fovSettings.enabled = e
            if not e and cam then
                cam.FieldOfView = originalFOV
            end
        end
    })
    
    CameraSection:Slider({
        Name = "FOV Value", 
        Min = 70, 
        Default = 90, 
        Max = 120, 
        Callback = function(v)
            fovSettings.value = v
            if fovSettings.enabled and cam then
                cam.FieldOfView = v
            end
        end
    })
    
    CameraSection:Toggle({
        Name = "HideUI", 
        Default = false, 
        Callback = function(Value)
            if Value then
                hideUIInLevelFrame({"Stat", "LevelNumber", "Levelbox", "bar", "bar2", "Max", "BG"})
            else
                showUIInLevelFrame()
            end
        end
    })
    
    return self
end

return FOVModule